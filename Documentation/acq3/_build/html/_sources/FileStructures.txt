==================
Supporting Files
==================

--------------
Configuration
--------------

The configuration file describes the location of data, acquisition and
stimulus files, the amplifier type in use, and the default stimulus
files to be used when switching to current or voltage clamp. The
configuration file is created by the command new config, and the named
fields can be filed in. The configuration file is saved with the
command ``sc`` (for save config). A different configuration file can be
loaded with the command ``gc`` (for get config). If the configuration
parameters are not current visible in the window, they can be brought
forward either by selecting the config button, or by issuing the
command  ``e config`` (``editconfig``).

When the configuration parameters are displayed, the names of the
parameters, listed on the left side of the window, can be used as the
commands to set the values on the right. Most of the parameters are
self explanatory. However there are a few rules:
The ``BasePath`` is the path under which the various stimulus parameter,
acquisition parameter and data files are stored. The stimulus,
acquisition and data paths should be entered relative to this base
path::

    BasePath c:\mat_datac\acq
    StmPath StmPar (Where the program expects to find the stimulus files.
    Note that this can be modified through the protocol menu.)
    AcqPath AcqPar (Where the program expects to find the acquisition
    parameter files.)
    DataPath Data (Where the program stores the data, and associated
    temporary data files.)

The configuration parameter UserExt defines a text string that is
prepended to the filename. This is to allow the files to have unique
identifiers in case the program is used to collect data in an
environment with more than one data collection occurring on a given
day.

----------------
Stimulus files
----------------

Stimulus files are central to the data acquisition operation of the
program. The stimulus files are really MATLAB structures that are
polymorphic: each different kind of stimulus is generated by a
different method, which is driven by the data from the associated
structure. The stimulus files all have a common header region, and a
variable tail. The header contains identification of the file type
(``stim``), the name of the file, and, upon writing to the data file, the
m-code for the method and a possibly a copy of the stimulus waveforms.
The header region is not visible to the user, and cannot be changed
except within the program. Thus, this structure contains everything
about the stimulus that might be needed at a later point either to
reconstruct the stimulus or to determine glitches in stimulus
computation (which of course will never happen).

The variable region of the stimulus file contains the data that is
used to drive the generation of the stimulus waveforms by the method
routine. For example, the files for the steps method contains
information about the step levels and durations, the stimulus
sequence, scale factors, holding voltages/currents, which parameter
types and which step elements are to be sequenced, the associated
acquisition control structure/file, and an optional pointer to a
stimulus file that can be superimposed on the primary file. Note that
if the associated acquisition control file field is empty, then the
current acquisition field will be stored along with the stimulus data.
This is the preferred method.

The current stimulus waveform can be previewed with the ``pv`` command,
and saved to disk with the s [name] command. If the name doesn't match
the filename field in the structure, then the program will ask if the
name should be changed. Stimulus files are restored from disk with the
g [name] command; if no name is given a GUI file browser interface is
provided to access the files. The contents of the current stimulus
structure can be listed with the ``ls`` command from the MATLAB command
line; and the structure itself can be returned to the base workspace
with a command such as ``s = ls``; s will contain ``STIM (s.STIM)``, which is
the stimulus structure data. It is useful to examine these structures
and the ``new.m`` file when writing new stimulus methods and structures
(Details of the specific default methods provided with the program are
described below).

Stimulus files are stored on disk in the directory designated by the
configuration. The files are stored as standard MATLAB .mat files, and
contain a single structure corresponding to the stimulus. If no
acquisition file is specified when the stimulus file is stored with s,
then the presently loaded acquisition file is save along with the
stimulus file; thus the file contains two structures, and retrieving
the stimulus file then retrieves the acquisition information also.

----------------------
Acquisition parameters
----------------------

The control of data acquisition is separate from the generation of
stimuli, in the sense that it is held in a different structure that
can be reused or shared by different stimulus paradigms, or
alternatively, stored with the stimulus paradigm. Acquisition
structures are not polymorphic (there is only one kind of acquisition
structure). Each acquisition structure consists of a fixed section,
and a variable, user modifiable section. Acquisition parameters
include the channels to be collected, the sample rate, the number of
points, the acquisition mode (voltage or current clamp), parameters
that control the refresh of the display and points displayed,
amplifier gains, acquisition hardware range settings and scale
factors, filter settings, and potentially a junction potential offset.
If not currently visible, the acquisition structure can be brought
forward with the command ``e acq``. The current structure can be saved
with ``sa [name]``, and retrieved with ``ga [name]``. The data in the structure
can be listed at the MATLAB command line with the ld command, or
retrieved into the base workspace with the command ``d = ld``. When the
acquisition structure is currently displayed, the parameters can be
edited using the same methods as described above for the stimulus
parameters.
